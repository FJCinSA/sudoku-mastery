@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap');

/* ── LAYOUT ──────────────────────────────────── */
html, body { font-size:16px; line-height:1.6; min-height:100vh; }
.app { max-width:900px; margin:0 auto; padding:0 16px 100px; }

/* ── HEADER ──────────────────────────────────── */
.hdr { text-align:center; padding:36px 0 24px; border-bottom:1px solid var(--border); margin-bottom:28px; }
.hdr-title { font-family:'Playfair Display',serif; font-size:clamp(1.6rem,5vw,2.6rem); color:var(--gold); letter-spacing:.04em; line-height:1.1; }
.hdr-sub { font-size:.78rem; letter-spacing:.25em; text-transform:uppercase; color:var(--muted); margin-top:6px; }

/* ── CHAPTER NAV ─────────────────────────────── */
.nav { display:flex; gap:6px; flex-wrap:wrap; margin-bottom:28px; padding:14px; background:var(--bg2); border:1px solid var(--border); border-radius:8px; }
.nav-btn { flex:1; min-width:70px; padding:8px 4px; background:transparent; border:1px solid var(--border); border-radius:5px; color:var(--text3); font-family:'Source Serif 4',serif; font-size:.68rem; cursor:pointer; transition:all .2s; text-align:center; line-height:1.3; position:relative; }
.nav-btn .nav-num { display:block; font-family:'JetBrains Mono',monospace; font-size:.62rem; color:var(--muted); margin-bottom:2px; }
.nav-btn:hover { border-color:var(--gold); color:var(--text2); }
.nav-btn.active { border-color:var(--gold); color:var(--gold); background:var(--hint-bg); }
.nav-btn.active .nav-num { color:var(--gold); }
.nav-btn.done { border-color:var(--ok); color:var(--ok); }
.nav-btn.done .nav-num { color:var(--ok); }
.nav-chk { color:var(--ok); font-size:.7rem; }
.nav-acc { display:block; font-family:'JetBrains Mono',monospace; font-size:.55rem; color:var(--amber); margin-top:1px; }

/* ── PROGRESS BAR ────────────────────────────── */
.progress-strip { height:3px; background:var(--bg3); margin-bottom:0; border-radius:0; }
.progress-fill { height:100%; background:linear-gradient(90deg,var(--amber),var(--gold),var(--gold2)); transition:width .8s ease; width:0%; }

/* ── CHAPTER DISPLAY ─────────────────────────── */
.chapter { display:none; }
.chapter.active { display:block; animation:fadeIn .3s ease; }
.ch-header { margin-bottom:20px; }
.ch-num { font-family:'JetBrains Mono',monospace; font-size:.7rem; letter-spacing:.2em; color:var(--muted); text-transform:uppercase; }
.ch-title { font-family:'Playfair Display',serif; font-size:clamp(1.3rem,4vw,1.9rem); color:var(--gold2); line-height:1.2; margin-top:4px; }
.ch-tag { display:inline-block; margin-top:6px; padding:2px 10px; border-radius:20px; font-size:.68rem; letter-spacing:.1em; text-transform:uppercase; border:1px solid; }
.tag-foundation  { color:var(--blue);  border-color:var(--blue);  background:#5a8fc815; }
.tag-beginner    { color:var(--ok);    border-color:var(--ok);    background:#6aaa6a15; }
.tag-intermediate{ color:var(--amber); border-color:var(--amber); background:#d4853a15; }
.tag-advanced    { color:#c878e8;      border-color:#c878e8;      background:#c878e815; }

/* ── TWO-COLUMN LAYOUT ───────────────────────── */
.ch-body { display:grid; grid-template-columns:1fr 1fr; gap:20px; height:calc(100vh - 220px); max-height:780px; }
.ch-body>.board-wrap { align-self:start; position:sticky; top:0; height:fit-content; }
.ch-body>.panel { overflow-y:auto; padding-right:6px; height:100%; scrollbar-width:thin; scrollbar-color:var(--border) transparent; }

@media(max-width:700px) {
  .ch-body { grid-template-columns:1fr; height:auto; max-height:none; }
  .ch-body>.panel { overflow-y:visible; height:auto; }
  .ch-body>.board-wrap { position:relative; top:auto; margin-bottom:16px; }
  .board { width:min(260px,80vw); margin:0 auto; }
  .board-label { text-align:center; }
}

/* ── BOARD ───────────────────────────────────── */
.board-label { font-size:.68rem; letter-spacing:.12em; text-transform:uppercase; color:var(--muted); margin-bottom:8px; font-family:'JetBrains Mono',monospace; }
.board { display:grid; grid-template-columns:repeat(9,1fr); border:2px solid var(--gold); border-radius:4px; overflow:hidden; aspect-ratio:1; width:100%; max-width:280px; background:var(--bg3); box-shadow:0 4px 24px #0008; }
.cell { aspect-ratio:1; display:flex; align-items:center; justify-content:center; font-family:'JetBrains Mono',monospace; font-size:clamp(.65rem,2vw,.95rem); font-weight:600; border:.5px solid var(--border); position:relative; cursor:default; transition:background .15s,color .15s; user-select:none; -webkit-user-select:none; }
.cell:nth-child(3n)                     { border-right:1.5px solid #5a4e3a; }
.cell:nth-child(n+19):nth-child(-n+27)  { border-bottom:1.5px solid #5a4e3a; }
.cell:nth-child(n+46):nth-child(-n+54)  { border-bottom:1.5px solid #5a4e3a; }
.cell.given   { color:var(--text); }
.cell.empty   { color:transparent; }
.cell.target  { cursor:pointer; background:var(--hint-bg); border-color:var(--gold) !important; }
.cell.target:hover { background:#332e22; }
.cell.hl-row, .cell.hl-col, .cell.hl-box { background:#1a1710; }
.cell.annot   { background:#1e1a12; }
.cell.pair    { color:var(--pair-col); background:#0e1828; }
.cell.point   { color:var(--point-col); background:#1e0e08; }
.cell.xwing   { color:var(--xwing-col); background:#150e1e; }
.cell.elim    { color:var(--err); background:#1e0a08; }
.cell.correct { color:var(--ok) !important; background:#0a1e0a !important; animation:cellPop .4s ease; }
.cell.wrong   { animation:cellShake .35s ease; }
.cell.step-hi { background:#2a2208; color:var(--gold2); }
.cell.sel     { background:#332e22; border-color:var(--gold2) !important; color:var(--gold2); }
@keyframes cellPop   { 0%{transform:scale(1)} 40%{transform:scale(1.18)} 100%{transform:scale(1)} }
@keyframes cellShake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-4px)} 75%{transform:translateX(4px)} }

/* ── NOTES ───────────────────────────────────── */
.nts { display:grid; grid-template-columns:repeat(3,1fr); width:100%; height:100%; padding:2px; }
.nts span { display:flex; align-items:center; justify-content:center; font-size:clamp(.28rem,.75vw,.4rem); line-height:1; font-family:'JetBrains Mono',monospace; color:var(--text3); }
.nts span.hi { color:var(--gold); }
.nts span.bl { color:var(--pair-col); }
.nts span.st { color:var(--err); text-decoration:line-through; }

/* ── INSTRUCTION PANEL ───────────────────────── */
.panel { display:flex; flex-direction:column; gap:14px; }
.card { background:var(--bg2); border:1px solid var(--border); border-radius:6px; padding:15px; }
.card-title { font-family:'Playfair Display',serif; font-size:.93rem; color:var(--gold); margin-bottom:10px; display:flex; align-items:center; gap:8px; }
.card p { font-size:.95rem; color:var(--text2); line-height:1.8; margin-bottom:12px; }
.card p:last-child { margin-bottom:0; }
.card strong { color:var(--gold2); font-weight:600; }
.card em { color:var(--amber); font-style:normal; }
.insight { background:var(--hint-bg); border-left:3px solid var(--gold); border-radius:0 4px 4px 0; padding:14px 16px; font-size:.92rem; color:var(--text2); line-height:1.8; margin-top:12px; }
.insight strong { color:var(--gold2); }

/* ── STEP LIST ───────────────────────────────── */
.steps { list-style:none; counter-reset:step; margin-top:4px; }
.steps li { counter-increment:step; display:flex; gap:10px; margin-bottom:13px; font-size:.92rem; color:var(--text2); line-height:1.75; }
.steps li::before { content:counter(step); display:flex; align-items:center; justify-content:center; min-width:20px; height:20px; border-radius:50%; background:var(--bg4); border:1px solid var(--gold); color:var(--gold); font-family:'JetBrains Mono',monospace; font-size:.62rem; font-weight:600; flex-shrink:0; margin-top:1px; }
.steps li strong { color:var(--gold2); }

/* ── WALKTHROUGH ─────────────────────────────── */
.walkthrough { display:flex; flex-direction:column; gap:7px; }
.wk-step { padding:13px 16px; background:var(--bg3); border:1px solid var(--border); border-radius:4px; font-size:.92rem; color:var(--text3); cursor:pointer; transition:all .2s; display:flex; align-items:flex-start; gap:9px; }
.wk-step .wk-n { font-family:'JetBrains Mono',monospace; font-size:.62rem; color:var(--muted); min-width:18px; margin-top:1px; flex-shrink:0; }
.wk-step:hover { border-color:var(--gold); color:var(--text2); }
.wk-step.active { border-color:var(--gold); background:var(--hint-bg); color:var(--text); }
.wk-step.active .wk-n { color:var(--gold); }
.wk-step.done { border-color:var(--ok); color:var(--text2); }
.wk-step.done .wk-n { color:var(--ok); }

/* ── EXERCISE ────────────────────────────────── */
.ex-card { background:var(--bg2); border:1px solid var(--amber); border-radius:6px; padding:15px; }
.ex-title { font-family:'Playfair Display',serif; font-size:.93rem; color:var(--amber); margin-bottom:8px; display:flex; align-items:center; gap:8px; }
.ex-prompt { font-size:.92rem; color:var(--text2); margin-bottom:16px; line-height:1.8; }
.numpad { display:flex; flex-wrap:wrap; gap:6px; margin-bottom:10px; }
.np-btn { width:36px; height:36px; background:var(--bg3); border:1px solid var(--border); border-radius:4px; color:var(--text2); font-family:'JetBrains Mono',monospace; font-size:.88rem; font-weight:600; cursor:pointer; transition:all .15s; }
.np-btn:hover { border-color:var(--gold); color:var(--gold); background:var(--hint-bg); }
.np-btn.pressed { transform:scale(.88); background:var(--hint-bg); border-color:var(--gold); }
.fb { min-height:32px; padding:9px 13px; border-radius:4px; font-size:.9rem; line-height:1.6; display:none; }
.fb.show { display:block; animation:fadeIn .25s ease; }
.fb.ok  { background:#0a1e0a; border:1px solid var(--ok);  color:var(--ok); }
.fb.err { background:#1e0a08; border:1px solid var(--err); color:var(--err); }
.ex-prog { font-size:.72rem; color:var(--text3); margin-top:8px; font-family:'JetBrains Mono',monospace; }

/* ── COMPLETION BADGE ────────────────────────── */
.badge { display:none; text-align:center; padding:18px; background:var(--hint-bg); border:1px solid var(--gold); border-radius:6px; margin-top:4px; }
.badge.show { display:block; animation:fadeIn .4s ease; }
.badge-icon { font-size:1.8rem; margin-bottom:6px; }
.badge-title { font-family:'Playfair Display',serif; color:var(--gold2); font-size:.93rem; margin-bottom:3px; }
.badge-text { font-size:.74rem; color:var(--text3); }

/* ── CHAPTER FOOTER ──────────────────────────── */
.ch-footer { margin-top:22px; display:flex; align-items:center; justify-content:space-between; gap:12px; padding-top:18px; border-top:1px solid var(--border); }
.dots { display:flex; gap:5px; }
.dot { width:7px; height:7px; border-radius:50%; background:var(--bg4); border:1px solid var(--border); transition:all .3s; cursor:pointer; }
.dot:hover { border-color:var(--gold); }
.dot.done { background:var(--ok);  border-color:var(--ok); }
.dot.cur  { background:var(--gold); border-color:var(--gold); }

/* ── BUTTONS ─────────────────────────────────── */
.btn { padding:8px 18px; border-radius:4px; font-family:'Source Serif 4',serif; font-size:.8rem; cursor:pointer; transition:all .2s; border:1px solid; }
.btn-p { background:var(--gold);  border-color:var(--gold);   color:var(--bg); font-weight:600; }
.btn-p:hover { background:var(--gold2); border-color:var(--gold2); }
.btn-s { background:transparent; border-color:var(--border); color:var(--text3); }
.btn-s:hover { border-color:var(--gold); color:var(--text2); }
.btn:disabled { opacity:.4; cursor:not-allowed; }
.btn-row { display:flex; gap:8px; }

/* ── COMPLETION SCREEN ───────────────────────── */
.complete { text-align:center; padding:48px 20px; }
.complete-icon { font-size:3rem; margin-bottom:14px; }
.complete-title { font-family:'Playfair Display',serif; font-size:1.8rem; color:var(--gold2); margin-bottom:8px; }
.complete-sub { color:var(--text3); font-size:.83rem; margin-bottom:28px; }
.complete-tags { display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin-bottom:32px; }
.complete-tag { padding:5px 13px; border-radius:20px; font-size:.75rem; border:1px solid; }
.tag-ok  { color:var(--ok);    border-color:var(--ok); }
.tag-amb { color:var(--amber); border-color:var(--amber); }
.tag-adv { color:#c878e8;      border-color:#c878e8; }
.complete-btns { display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }

/* ═══════════════════════════════════════════════
   AI COACH — FLOATING CHAT SYSTEM
   ═══════════════════════════════════════════════ */

/* ── FLOATING TRIGGER BUTTON ─────────────────── */
#coach-btn {
  position:fixed; bottom:28px; right:28px; z-index:500;
  width:54px; height:54px; border-radius:50%;
  background:linear-gradient(135deg,#1a170f,#2a2518);
  border:1.5px solid var(--gold);
  color:var(--gold); font-size:1.3rem;
  display:flex; align-items:center; justify-content:center;
  cursor:pointer; box-shadow:0 4px 20px #00000070,0 0 0 0 var(--gold);
  transition:transform .2s, box-shadow .2s, background .2s;
  user-select:none;
}
#coach-btn:hover {
  transform:translateY(-3px) scale(1.05);
  box-shadow:0 8px 28px #00000090, 0 0 0 3px #c8a96e22;
  background:linear-gradient(135deg,#221e14,#332e22);
}
#coach-btn.has-alert {
  animation:coachPulse 2s ease-in-out infinite;
  border-color:var(--amber);
  color:var(--amber);
}
#coach-btn .coach-badge {
  position:absolute; top:-4px; right:-4px;
  width:16px; height:16px; border-radius:50%;
  background:var(--amber); color:var(--bg);
  font-size:.6rem; font-weight:700;
  display:flex; align-items:center; justify-content:center;
  font-family:'JetBrains Mono',monospace;
  display:none;
}
#coach-btn.has-alert .coach-badge { display:flex; }
@keyframes coachPulse {
  0%,100%  { box-shadow:0 4px 20px #00000070, 0 0 0 0 #c8732a40; }
  50%      { box-shadow:0 4px 20px #00000070, 0 0 0 8px #c8732a00; }
}

/* ── CHAT PANEL ──────────────────────────────── */
#coach-panel {
  position:fixed; bottom:92px; right:28px; z-index:500;
  width:340px; max-width:calc(100vw - 40px);
  background:var(--bg2);
  border:1px solid var(--gold);
  border-radius:12px;
  box-shadow:0 20px 60px #00000090, 0 0 0 1px #c8a96e18;
  display:flex; flex-direction:column;
  overflow:hidden;
  transform:translateY(20px) scale(.96);
  opacity:0;
  pointer-events:none;
  transition:transform .28s cubic-bezier(.34,1.56,.64,1), opacity .22s ease;
}
#coach-panel.open {
  transform:translateY(0) scale(1);
  opacity:1;
  pointer-events:all;
}

/* ── PANEL HEADER ────────────────────────────── */
.coach-head {
  display:flex; align-items:center; gap:10px;
  padding:13px 16px; border-bottom:1px solid var(--border);
  background:linear-gradient(90deg,var(--bg3),var(--bg2));
  flex-shrink:0;
}
.coach-avatar {
  width:34px; height:34px; border-radius:50%;
  background:linear-gradient(135deg,#c8a96e30,#c8732a20);
  border:1px solid var(--gold);
  display:flex; align-items:center; justify-content:center;
  font-size:1rem; flex-shrink:0;
}
.coach-name { font-family:'Playfair Display',serif; font-size:.88rem; color:var(--gold2); }
.coach-status { font-family:'JetBrains Mono',monospace; font-size:.58rem; color:var(--muted); letter-spacing:.1em; text-transform:uppercase; }
.coach-close {
  margin-left:auto; background:none; border:none;
  color:var(--text3); font-size:1.1rem; cursor:pointer;
  padding:4px 6px; border-radius:4px; transition:color .2s;
}
.coach-close:hover { color:var(--gold); }

/* ── CHAPTER CONTEXT PILL ────────────────────── */
.coach-context {
  padding:6px 14px;
  background:var(--bg3);
  border-bottom:1px solid var(--border);
  font-family:'JetBrains Mono',monospace;
  font-size:.6rem; color:var(--muted);
  letter-spacing:.1em; text-transform:uppercase;
  flex-shrink:0;
}
.coach-context span { color:var(--gold); }

/* ── MESSAGE THREAD ──────────────────────────── */
#coach-msgs {
  flex:1; overflow-y:auto; padding:14px 14px 6px;
  display:flex; flex-direction:column; gap:10px;
  max-height:320px; min-height:120px;
  scrollbar-width:thin; scrollbar-color:var(--border) transparent;
}
#coach-msgs::-webkit-scrollbar { width:4px; }
#coach-msgs::-webkit-scrollbar-track { background:transparent; }
#coach-msgs::-webkit-scrollbar-thumb { background:var(--border); border-radius:4px; }

.msg {
  display:flex; gap:8px; align-items:flex-start;
  animation:msgIn .25s ease;
}
.msg.user { flex-direction:row-reverse; }
@keyframes msgIn { from{opacity:0;transform:translateY(6px)} to{opacity:1;transform:none} }

.msg-bubble {
  max-width:84%; padding:9px 12px; border-radius:10px;
  font-size:.84rem; line-height:1.65; font-family:'Source Serif 4',serif;
}
.msg.coach .msg-bubble {
  background:var(--bg3); border:1px solid var(--border);
  color:var(--text2); border-radius:2px 10px 10px 10px;
}
.msg.user .msg-bubble {
  background:var(--hint-bg); border:1px solid #c8a96e30;
  color:var(--text); border-radius:10px 2px 10px 10px;
}
.msg.coach.proactive .msg-bubble {
  border-color:var(--amber); background:#1a0e06;
  color:var(--text2);
}
.msg-avatar {
  width:24px; height:24px; border-radius:50%; flex-shrink:0;
  display:flex; align-items:center; justify-content:center;
  font-size:.75rem; margin-top:2px;
}
.msg.coach .msg-avatar { background:var(--bg4); border:1px solid var(--border); }
.msg.user  .msg-avatar { background:var(--hint-bg); border:1px solid #c8a96e30; color:var(--gold); }

/* ── TYPING INDICATOR ────────────────────────── */
.typing-bubble {
  display:flex; align-items:center; gap:4px;
  padding:10px 14px; background:var(--bg3);
  border:1px solid var(--border); border-radius:2px 10px 10px 10px;
}
.typing-dot {
  width:5px; height:5px; border-radius:50%; background:var(--muted);
  animation:typingBounce 1.2s ease-in-out infinite;
}
.typing-dot:nth-child(2) { animation-delay:.15s; }
.typing-dot:nth-child(3) { animation-delay:.3s; }
@keyframes typingBounce { 0%,60%,100%{transform:translateY(0)} 30%{transform:translateY(-6px)} }

/* ── QUICK PROMPTS ───────────────────────────── */
.coach-quick {
  padding:8px 12px 0;
  display:flex; gap:6px; flex-wrap:wrap;
  border-top:1px solid var(--border);
  flex-shrink:0;
}
.quick-btn {
  padding:4px 10px; border-radius:20px;
  background:var(--bg3); border:1px solid var(--border);
  color:var(--text3); font-size:.7rem;
  font-family:'JetBrains Mono',monospace; letter-spacing:.05em;
  cursor:pointer; transition:all .15s; white-space:nowrap;
}
.quick-btn:hover { border-color:var(--gold); color:var(--gold); background:var(--hint-bg); }

/* ── INPUT ROW ───────────────────────────────── */
.coach-input-row {
  display:flex; gap:8px; padding:10px 12px 12px;
  border-top:1px solid var(--border);
  flex-shrink:0;
}
#coach-input {
  flex:1; padding:9px 12px;
  background:var(--bg3); border:1px solid var(--border);
  border-radius:6px; color:var(--text);
  font-family:'Source Serif 4',serif; font-size:.83rem;
  outline:none; transition:border-color .2s;
  resize:none; height:36px; overflow:hidden;
}
#coach-input::placeholder { color:var(--text3); }
#coach-input:focus { border-color:var(--gold); }
#coach-send {
  width:36px; height:36px; flex-shrink:0;
  background:var(--gold); border:none; border-radius:6px;
  color:var(--bg); font-size:1rem; cursor:pointer;
  transition:background .2s; display:flex;
  align-items:center; justify-content:center;
}
#coach-send:hover { background:var(--gold2); }
#coach-send:disabled { opacity:.4; cursor:not-allowed; }
